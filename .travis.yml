os:
    - linux
cache:
    directories:
        - precompiled
        - html
        - highlights/node_modules
        - $HOME/.rakudobrew
addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
      - graphviz
      - g++-4.8
      - ruby-sass

fast_finish: true
services: docker

branches:
  except:
    - gh-pages
notifications:
  irc:
    channels:
    - "irc.freenode.net#perl6"
    on_success: change
    on_failure: always
    template:
      - "Doc build %{result}. %{author} '%{commit_message}'"
      - "%{build_url} %{compare_url}"

before_install:
  - nvm install 7.2.1
  - nvm use 7.2.1
  
install:
  - docker run -t -v  $TRAVIS_BUILD_DIR:/test  --entrypoint="/bin/sh" jjmerelo/test-perl6  -c zef install --deps-only .
  - docker run -t -v  $TRAVIS_BUILD_DIR:/test  --entrypoint="/bin/sh" jjmerelo/test-perl6  -c zef install LWP::Simple

script:
  - docker run -t -v  $TRAVIS_BUILD_DIR:/test jjmerelo/test-perl6
  - export CXX=$(command -v g++-4.8 >/dev/null 2>&1; if [ $? -eq 1 ]; then printf "g++"; else printf "g++-4.8"; fi)
  - $CXX --version
  - make html-nohighlight
#  - make html
matrix:
  allow_failures:
    - os: osx
